



IPPM Working Group                                        R. Gandhi, Ed.
Internet-Draft                                               C. Filsfils
Intended status: Standards Track                     Cisco Systems, Inc.
Expires: July 27, 2021                                          D. Voyer
                                                             Bell Canada
                                                                 M. Chen
                                                                  Huawei
                                                             B. Janssens
                                                                    Colt
                                                        January 23, 2021


         Simple TWAMP (STAMP) Extensions for Direct Measurement
                   draft-gandhi-ippm-stamp-direct-00

Abstract

   This document specifies RFC 8762 (Simple Two-Way Active Measurement
   Protocol (STAMP)) extensions for Direct Measurement for detecting
   packet loss in a network those are efficient for hardware-based
   implementation.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on July 27, 2021.

Copyright Notice

   Copyright (c) 2021 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (https://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents



Gandhi, et al.            Expires July 27, 2021                 [Page 1]

Internet-Draft   STAMP Extensions for Direct Measurement    January 2021


   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Conventions Used in This Document . . . . . . . . . . . . . .   3
     2.1.  Requirements Language . . . . . . . . . . . . . . . . . .   3
     2.2.  Abbreviations . . . . . . . . . . . . . . . . . . . . . .   3
     2.3.  Reference Topology  . . . . . . . . . . . . . . . . . . .   3
     2.4.  UDP Port Numbers For Direct Measurement . . . . . . . . .   4
   3.  Direct Measurement Test Packet  . . . . . . . . . . . . . . .   4
   4.  Session-Reflector Direct Measurement Test Packet  . . . . . .   7
   5.  Packet Loss Calculation . . . . . . . . . . . . . . . . . . .   9
   6.  Security Considerations . . . . . . . . . . . . . . . . . . .   9
   7.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   9
     7.1.  Normative References  . . . . . . . . . . . . . . . . . .   9
     7.2.  Informative References  . . . . . . . . . . . . . . . . .  10
   Acknowledgments . . . . . . . . . . . . . . . . . . . . . . . . .  10
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  10

1.  Introduction

   The Simple Two-way Active Measurement Protocol (STAMP) provides
   capabilities for the measurement of various performance metrics in IP
   networks using test packets [RFC8762].  It eliminates the need for
   control protocol by using configuration data model to provision test
   sessions.  [RFC8972] defines optional extensions for STAMP.

   Many Service Provider Service Level Agreements (SLAs) depend on the
   ability to measure performance loss metric experienced by Customer
   data traffic.  The STAMP test packet with a TLV for "direct
   measurement" can be used for combined Delay + Packet Loss measurement
   [RFC8972].  However, in order to use only for direct measurement
   purpose, it requires the node to support the STAMP test packets and
   support timestamp for these packets, in addition to counters.
   Furthermore, for hardware-based counter collection for direct
   measurement, the optional TLV based processing adds unnecessary
   overhead (as counters are not at well-known locations).  In addition,
   it does not support 64-bit counters, counters for Bytes, as well as
   counters per traffic class.  It also does not identify the Block
   Number of the direct measurement required for Alternate-Marking
   Method [RFC8321] for loss measurement.





Gandhi, et al.            Expires July 27, 2021                 [Page 2]

Internet-Draft   STAMP Extensions for Direct Measurement    January 2021


   This document specifies RFC 8762 (Simple Two-Way Active Measurement
   Protocol (STAMP)) extensions for Direct Measurement for detecting
   packet loss in a network those are efficient for hardware-based
   implementation.

2.  Conventions Used in This Document

2.1.  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119] [RFC8174]
   when, and only when, they appear in all capitals, as shown here.

2.2.  Abbreviations

   HMAC: Hashed Message Authentication Code.

   LM: Loss Measurement.

   PM: Performance Measurement.

   SSID: STAMP Session Identifier.

   STAMP: Simple Two-way Active Measurement Protocol.

2.3.  Reference Topology

   As shown in the reference topology blow, the STAMP Session-Sender R1
   transmits direct measurement test packets over UDP transport toward
   the STAMP Session-Reflector R3.  The STAMP Session-Reflector R3
   receives the Session-Sender's packet and acts according to the
   configuration.  The Session-Reflector R3 sends Reply Test Packet to
   Session-Sender R1.

                          C1                C2
                         /                   \
                +-------+     Test Packet     +-------+
                |       | - - - - - - - - - ->|       |
                |   R1  |=====================|   R3  |
                |       |<- - - - - - - - - - |       |
                +-------+  Reply Test Packet  +-------+
                         \                   /
                          C4                C3

                Session-Sender                Session-Reflector

                           Reference Topology



Gandhi, et al.            Expires July 27, 2021                 [Page 3]

Internet-Draft   STAMP Extensions for Direct Measurement    January 2021


2.4.  UDP Port Numbers For Direct Measurement

   The direct measurement test packets carry user-configured destination
   UDP port.  The UDP port 862 is not used for direct measurement test
   packets defined in this document.  The user-configured destination
   UDP port follows the guidelines described in [RFC8762].  Different
   destination UDP port is used for direct measurement than the STAMP
   test packets defined in [RFC8762].

3.  Direct Measurement Test Packet

   In this document, session-sender test packet formats for direct
   measurement are defined as shown in Figure 1 and Figure 2.  They are
   stand-alone packet formats to carry counters for the traffic flow
   under measurement.  The test packet formats are similar to the STAMP
   test packet formats (for example location of the Counters and
   Timestamps).  The test packets do not require backwards compatibility
   and support for the existing STAMP test packet formats defined in
   [RFC8762] as different user-configured destination UDP port is used
   for direct measurement.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Sequence Number                        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Transmit Counter                       |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |X|B|T| DSCP      | Block Number| SSID                          |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |         MBZ                                   | Control Code  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    |                        MBZ (24 octets)                        |
    |                                                               |
    |                                                               |
    |                                                               |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

         Figure 1: Session-Sender Direct Measurement Test Packet -
                           Unauthenticated Mode








Gandhi, et al.            Expires July 27, 2021                 [Page 4]

Internet-Draft   STAMP Extensions for Direct Measurement    January 2021


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Sequence Number                        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        MBZ (12 octets)                        |
    |                                                               |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Transmit Counter                       |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |X|B|T| DSCP      | Block Number| SSID                          |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |         MBZ                                   | Control Code  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        MBZ (64 octets)                        |
    .                                                               .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    |                        HMAC (16 octets)                       |
    |                                                               |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

         Figure 2: Session-Sender Direct Measurement Test Packet -
                            Authenticated Mode

   Sequence Number (32-bit): As defined in [RFC8762].

   Transmit Counter (64-bit): The number of packets or octets sent by
   the session-sender in the test packet and by the session-reflector in
   the reply test packet.  The counter is always written at the well-
   known fixed location in the test packet and reply test packet.  This
   is an important property for hardware-based implementation.  Counter
   is for the traffic flow under measurement.

   Flags: The meanings of the Flag bits are:

      X: Extended counter format indicator.  Indicates the use of
      extended (64-bit) counter values.  Initialized to 1 upon creation
      (and prior to transmission) of a test packet and copied from test
      packet to reply test packet.  Set to 0 when the test packet is
      transmitted or received over an interface that writes 32-bit
      counter values.

      B: Octet (byte) count.  When set to 1, indicates that the Counter
      fields represent octet counts.  The octet count applies to all



Gandhi, et al.            Expires July 27, 2021                 [Page 5]

Internet-Draft   STAMP Extensions for Direct Measurement    January 2021


      packets within the direct measurement scope, and the octet count
      of a packet sent or received includes the total length of that
      packet (but excludes headers, labels, or framing of the channel
      itself).  When set to 0, indicates that the Counter fields
      represent packet counts.

      T: Traffic-class-specific measurement indicator.  Set to 1 when
      the direct measurement operation is scoped to data packets of a
      particular traffic class (DSCP value), and 0 otherwise.  When set
      to 1, the DSCP field of the test packet indicates the measured
      traffic class.

   DSCP (6-bit): DSCP of the traffic being measured when T flag is set.

   Block Number (7-bit): The Direct Measurement using Alternate-Marking
   method defined in [RFC8321] requires to collect Block Number for the
   data traffic.  To be able to correlate the transmit and receive
   traffic counters of the matching block number, the Block Number of
   the traffic counters is carried by the test packet and reply test
   packet for direct measurement.

   SSID (16-bit): As defined in [RFC8972].

   Session-Sender Control Code Field (8-bit): Flags set as follows in
   STAMP session-sender test packet [I-D.gandhi-ippm-stamp-srpm].

       0x0: The existing default behaviour as defined in [RFC8762].

       0x1: In-band Reply Requested.  Indicates that this test packet
       has been sent over a bidirectional path and the reply is
       requested in-band over the same path in the reverse direction.

       0x2: No Reply Requested.

   The MBZ fields are used to achieve alignment of fields within the
   packet on a four-octet boundary.  The value of each MBZ field MUST be
   zeroed on transmission and MUST be ignored on receipt.

   The detailed use of the HMAC field is described in Section 4.4 of
   [RFC8762].

   HMAC uses its own key and the mechanism to distribute the HMAC key is
   outside the scope of this document.








Gandhi, et al.            Expires July 27, 2021                 [Page 6]

Internet-Draft   STAMP Extensions for Direct Measurement    January 2021


4.  Session-Reflector Direct Measurement Test Packet

   In this document, session-reflector test packet formats for direct
   measurement are defined as shown in Figure 3 and Figure 4.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Sequence Number                        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Transmit Counter                       |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |X|B|T| DSCP      | Block Number| SSID                          |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Receive Counter                        |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Sender Sequence Number                 |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Sender Counter                         |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        MBZ (4 octets)                         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  Sender TTL   |        MBZ                                    |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

       Figure 3: Session-Reflector Direct Measurement Test Packet -
                           Unauthenticated Mode

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Sequence Number                        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        MBZ (12 octets)                        |
    |                                                               |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Transmit Counter                       |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |X|B|T| DSCP      | Block Number| SSID                          |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        MBZ (4 octets)                         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Receive Counter                        |



Gandhi, et al.            Expires July 27, 2021                 [Page 7]

Internet-Draft   STAMP Extensions for Direct Measurement    January 2021


    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        MBZ (8 octets)                         |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Sender Sequence Number                 |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        MBZ (12 octets)                        |
    |                                                               |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Sender Counter                         |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        MBZ (4 octets)                         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        MBZ (4 octets)                         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  Sender TTL   |                                               |
    +-+-+-+-+-+-+-+-+                                               |
    |                        MBZ (15 octets)                        |
    |                                                               |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    |                        HMAC (16 octets)                       |
    |                                                               |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

       Figure 4: Session-Reflector Direct Measurement Test Packet -
                            Authenticated Mode

   The session-reflector writes the transmit counter at the same
   location in the reply test packet as the session-sender test packet.
   This is an important property for hardware-based implementation.

   Receive Counter (64-bit): The number of packets or octets received at
   the session-reflector.  It is written by the session-reflector in the
   reply test packet.  Counter is for the traffic flow under
   measurement.

   Sender Counter (64-bit): This is the exact copy of the transmit
   counter from the received test packet.  It is written by the session-
   reflector in the reply test packet.

   Sender Sequence Number (32-bit): As defined in [RFC8762].




Gandhi, et al.            Expires July 27, 2021                 [Page 8]

Internet-Draft   STAMP Extensions for Direct Measurement    January 2021


   Sender TTL: As defined in [RFC8762].

5.  Packet Loss Calculation

   Using the Counters C1, C2, C3 and C4 as per reference topology, from
   the nth and (n-1)th direct measurement test packets.

   One-way receive packet loss[n-1, n] = (C2[n] - C2[n-1]) - (C1[n] -
   C1[n-1])

   Two-way receive packet loss[n-1, n] = (C4[n] - C4[n-1]) - (C3[n] -
   C3[n-1]) + (C2[n] - C2[n-1]) - (C1[n] - C1[n-1])

6.  Security Considerations

   The performance measurement is intended for deployment in well-
   managed private and service provider networks.  As such, it assumes
   that a node involved in a measurement operation has previously
   verified the integrity of the path and the identity of the session-
   reflector.

   If desired, attacks can be mitigated by performing basic validation
   and sanity checks, at the session-sender, of the counter or timestamp
   fields in received measurement reply test packets.  The minimal state
   associated with these protocols also limits the extent of measurement
   disruption that can be caused by a corrupt or invalid packet to a
   single test cycle.

   Use of HMAC-SHA-256 in the authenticated mode protects the data
   integrity of the test packets.  Cryptographic measures may be
   enhanced by the correct configuration of access-control lists and
   firewalls.

   The security considerations specified in [RFC8762] and [RFC8972] also
   apply to the extensions defined in this document.

7.  References

7.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.



Gandhi, et al.            Expires July 27, 2021                 [Page 9]

Internet-Draft   STAMP Extensions for Direct Measurement    January 2021


   [RFC8762]  Mirsky, G., Jun, G., Nydell, H., and R. Foote, "Simple
              Two-Way Active Measurement Protocol", RFC 8762,
              DOI 10.17487/RFC8762, March 2020,
              <https://www.rfc-editor.org/info/rfc8762>.

   [RFC8972]  Mirsky, G., Min, X., Nydell, H., Foote, R., Masputra, A.,
              and E. Ruffini, "Simple Two-Way Active Measurement
              Protocol Optional Extensions", RFC 8972,
              DOI 10.17487/RFC8972, January 2021,
              <https://www.rfc-editor.org/info/rfc8972>.

   [I-D.gandhi-ippm-stamp-srpm]
              Gandhi, R., Filsfils, C., Voyer, D., Chen, M., and B.
              Janssens, "Simple TWAMP (STAMP) Extensions for Segment
              Routing Networks", draft-gandhi-ippm-stamp-srpm-01 (work
              in progress), January 2021.

7.2.  Informative References

   [RFC8321]  Fioccola, G., Ed., Capello, A., Cociglio, M., Castaldelli,
              L., Chen, M., Zheng, L., Mirsky, G., and T. Mizrahi,
              "Alternate-Marking Method for Passive and Hybrid
              Performance Monitoring", RFC 8321, DOI 10.17487/RFC8321,
              January 2018, <https://www.rfc-editor.org/info/rfc8321>.

Acknowledgments

   The authors would like to thank Greg Mirsky, Tianran Zhou, Zhenqiang
   Li, Reshad Rahman, Cheng Li, and Yali Wang for the comments on direct
   measurement.  The authors would like to acknowledge the earlier work
   on the loss measurement using TWAMP described in draft-xiao-ippm-
   twamp-ext-direct-loss.

Authors' Addresses

   Rakesh Gandhi (editor)
   Cisco Systems, Inc.
   Canada

   Email: rgandhi@cisco.com


   Clarence Filsfils
   Cisco Systems, Inc.

   Email: cfilsfil@cisco.com





Gandhi, et al.            Expires July 27, 2021                [Page 10]

Internet-Draft   STAMP Extensions for Direct Measurement    January 2021


   Daniel Voyer
   Bell Canada

   Email: daniel.voyer@bell.ca


   Mach(Guoyi) Chen
   Huawei

   Email: mach.chen@huawei.com


   Bart Janssens
   Colt

   Email: Bart.Janssens@colt.net



































Gandhi, et al.            Expires July 27, 2021                [Page 11]
